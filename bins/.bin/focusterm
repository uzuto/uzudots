#!/bin/bash

OLD_IDS=$(xdotool search --class "Alacritty" 2>/dev/null | sort)
alacritty &

for i in {1..20}; do
    CURRENT_IDS=$(xdotool search --class "Alacritty" 2>/dev/null | sort)
    NEW_ID=$(comm -13 <(echo "$OLD_IDS") <(echo "$CURRENT_IDS") | head -n 1)

    if [ -n "$NEW_ID" ]; then
        sleep 0.15
        xdotool windowactivate "$NEW_ID"
        xdotool windowraise "$NEW_ID"
        exit 0
    fi
    sleep 0.1
done

LAST_EXISTING=$(xdotool search --class "Alacritty" | tail -1)
if [ -n "$LAST_EXISTING" ]; then
    xdotool windowactivate "$LAST_EXISTING"
fi
